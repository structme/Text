WITH cte AS (
    SELECT 
        log_id,
        kayıtdurum,
        logtarih,
        LEAD(kayıtdurum) OVER (PARTITION BY log_id ORDER BY logtarih) AS sonraki_kayıtdurum,
        LEAD(logtarih) OVER (PARTITION BY log_id ORDER BY logtarih) AS sonraki_logtarih
    FROM 
        log_tablosu
)
SELECT 
    log_id,
    kayıtdurum,
    sonraki_kayıtdurum,
    TIMESTAMPDIFF(SECOND, logtarih, sonraki_logtarih) AS sure_saniye
FROM 
    cte
WHERE 
    kayıtdurum = 4
    AND sonraki_kayıtdurum NOT IN (1, 2, 3, 4);
